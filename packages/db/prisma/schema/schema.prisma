generator client {
  provider     = "prisma-client"
  output       = "../generated"
  moduleFormat = "esm"
  runtime      = "bun"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @map("_id")
  name              String
  email             String             @unique
  emailVerified     Boolean
  image             String?
  isAdmin           Boolean            @default(false) @map("is_admin")
  telegramId        String?            @unique @map("telegram_id")
  telegramUsername  String?            @map("telegram_username")
  phoneNumber       String?            @map("phone_number")
  createdAt         DateTime
  updatedAt         DateTime
  accounts          Account[]
  bots              Bot[]
  dailyTokenClaims  DailyTokenClaim[]
  inviteLinks       InviteLink[]
  paymentOrders     PaymentOrder[]
  sessions          Session[]
  subscriptions     Subscription[]
  telegramEntities  TelegramEntity[]
  tokenBalance      TokenBalance?
  tokenTransactions TokenTransaction[]

  @@map("user")
}

model Session {
  id        String   @id @map("_id")
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Account {
  id                    String    @id @map("_id")
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("account")
}

model Verification {
  id         String    @id @map("_id")
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

model Plan {
  id               String         @id @default(uuid())
  name             String
  description      String?
  type             Int
  interval         Int
  price            Float
  tokensIncluded   Int            @map("tokens_included")
  dailyTokens      Int            @default(0) @map("daily_tokens")
  features         Json?
  isActive         Boolean        @default(true) @map("is_active")
  maxGroups        Int?           @map("max_groups")
  maxInvitesPerDay Int?           @map("max_invites_per_day")
  metadata         Json?
  createdAt        DateTime       @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime       @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt        DateTime?      @map("deleted_at") @db.Timestamptz(3)
  subscriptions    Subscription[]

  @@map("plan")
}

model Subscription {
  id               String            @id @default(uuid())
  userId           String            @map("user_id")
  planId           String            @map("plan_id")
  status           Int               @default(0)
  startDate        DateTime          @default(now()) @map("start_date") @db.Timestamptz(3)
  endDate          DateTime?         @map("end_date") @db.Timestamptz(3)
  autoRenew        Boolean           @default(true) @map("auto_renew")
  cancelledAt      DateTime?         @map("cancelled_at") @db.Timestamptz(3)
  metadata         Json?
  createdAt        DateTime          @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime          @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt        DateTime?         @map("deleted_at") @db.Timestamptz(3)
  dailyTokenClaims DailyTokenClaim[]
  plan             Plan              @relation(fields: [planId], references: [id])
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([planId])
  @@index([status])
  @@map("subscription")
}

model TokenBalance {
  id          String   @id @default(uuid())
  userId      String   @unique @map("user_id")
  balance     Int      @default(0)
  totalEarned Int      @default(0) @map("total_earned")
  totalSpent  Int      @default(0) @map("total_spent")
  metadata    Json?
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("token_balance")
}

model TokenTransaction {
  id           String    @id @default(uuid())
  userId       String    @map("user_id")
  type         Int
  status       Int       @default(0)
  amount       Int
  balanceAfter Int       @map("balance_after")
  description  String?
  reference    String?
  metadata     Json?
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt    DateTime  @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt    DateTime? @map("deleted_at") @db.Timestamptz(3)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@index([reference])
  @@map("token_transaction")
}

model TokenCostConfig {
  id           String    @id @default(uuid())
  durationUnit Int       @unique @map("duration_unit")
  costPerUnit  Int       @map("cost_per_unit")
  description  String?
  isActive     Boolean   @default(true) @map("is_active")
  metadata     Json?
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt    DateTime  @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt    DateTime? @map("deleted_at") @db.Timestamptz(3)

  @@map("token_cost_config")
}

model BotCostConfig {
  id              String   @id @default(uuid())
  costPerBot      Int      @map("cost_per_bot")
  freeBotsAllowed Int      @default(1) @map("free_bots_allowed")
  description     String?
  isActive        Boolean  @default(true) @map("is_active")
  metadata        Json?
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt       DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)

  @@map("bot_cost_config")
}

model AutomationCostConfig {
  id               String    @id @default(uuid())
  featureType      Int       @unique @map("feature_type")
  costPerRule      Int       @map("cost_per_rule")
  freeRulesAllowed Int       @default(1) @map("free_rules_allowed")
  description      String?
  isActive         Boolean   @default(true) @map("is_active")
  metadata         Json?
  createdAt        DateTime  @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime  @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt        DateTime? @map("deleted_at") @db.Timestamptz(3)

  @@map("automation_cost_config")
}

model Bot {
  id                String              @id @default(uuid())
  userId            String              @map("user_id")
  token             String
  username          String
  firstName         String              @map("first_name")
  botId             String              @unique @map("bot_id")
  status            Int                 @default(0)
  isDefault         Boolean             @default(false) @map("is_default")
  lastHealthCheck   DateTime?           @map("last_health_check") @db.Timestamptz(3)
  errorMessage      String?             @map("error_message")
  metadata          Json?
  createdAt         DateTime            @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt         DateTime            @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt         DateTime?           @map("deleted_at") @db.Timestamptz(3)
  autoApprovalRules AutoApprovalRule[]
  autoDropRules     AutoDropRule[]
  user              User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  botMembers        BotMember[]
  entityLinks       BotTelegramEntity[]
  broadcasts        Broadcast[]
  forwardRules      ForwardRule[]
  inviteLinks       InviteLink[]
  welcomeConfigs    WelcomeConfig[]

  @@index([userId])
  @@index([status])
  @@index([isDefault])
  @@map("bot")
}

model BotTelegramEntity {
  id               String         @id @default(uuid())
  botId            String         @map("bot_id")
  telegramEntityId String         @map("telegram_entity_id")
  isAdmin          Boolean        @default(false) @map("is_admin")
  adminPermissions Json?          @map("admin_permissions")
  isPrimary        Boolean        @default(false) @map("is_primary")
  syncedAt         DateTime?      @map("synced_at") @db.Timestamptz(3)
  metadata         Json?
  createdAt        DateTime       @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime       @updatedAt @map("updated_at") @db.Timestamptz(3)
  bot              Bot            @relation(fields: [botId], references: [id], onDelete: Cascade)
  telegramEntity   TelegramEntity @relation(fields: [telegramEntityId], references: [id], onDelete: Cascade)

  @@unique([botId, telegramEntityId])
  @@index([botId])
  @@index([telegramEntityId])
  @@index([isPrimary])
  @@map("bot_telegram_entity")
}

model TelegramEntity {
  id                   String              @id @default(uuid())
  userId               String              @map("user_id")
  telegramId           String              @map("telegram_id")
  type                 Int
  title                String
  username             String?
  description          String?
  memberCount          Int?                @map("member_count")
  isActive             Boolean             @default(true) @map("is_active")
  metadata             Json?
  createdAt            DateTime            @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt            DateTime            @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt            DateTime?           @map("deleted_at") @db.Timestamptz(3)
  autoApprovalRules    AutoApprovalRule[]
  autoDropRules        AutoDropRule[]
  botLinks             BotTelegramEntity[]
  forwardRulesAsDest   ForwardRule[]       @relation("ForwardDestination")
  forwardRulesAsSource ForwardRule[]       @relation("ForwardSource")
  groupMembers         GroupMember[]
  inviteLinks          InviteLink[]
  joinLogs             JoinLog[]
  user                 User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  welcomeConfigs       WelcomeConfig[]

  @@unique([telegramId, userId])
  @@index([userId])
  @@index([telegramId])
  @@index([type])
  @@map("telegram_entity")
}

model InviteLink {
  id               String         @id @default(uuid())
  telegramEntityId String         @map("telegram_entity_id")
  userId           String         @map("user_id")
  botId            String         @map("bot_id")
  botStartLink     String         @unique @map("bot_start_link")
  token            String         @unique
  durationType     Int            @map("duration_type")
  durationSeconds  Int            @map("duration_seconds")
  memberLimit      Int?           @map("member_limit")
  currentUses      Int            @default(0) @map("current_uses")
  status           Int            @default(0)
  linkExpiresAt    DateTime?      @map("link_expires_at") @db.Timestamptz(3)
  revokedAt        DateTime?      @map("revoked_at") @db.Timestamptz(3)
  tokensCost       Int            @map("tokens_cost")
  metadata         Json?
  createdAt        DateTime       @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime       @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt        DateTime?      @map("deleted_at") @db.Timestamptz(3)
  bot              Bot            @relation(fields: [botId], references: [id], onDelete: Cascade)
  telegramEntity   TelegramEntity @relation(fields: [telegramEntityId], references: [id], onDelete: Cascade)
  user             User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([telegramEntityId])
  @@index([botId])
  @@index([status])
  @@index([linkExpiresAt])
  @@index([durationType])
  @@index([token])
  @@map("invite_link")
}

model Config {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)

  @@map("config")
}

model PaymentGatewayConfig {
  id            String   @id @default(uuid())
  gateway       Int      @default(0)
  isActive      Boolean  @default(true) @map("is_active")
  isDefault     Boolean  @default(false) @map("is_default")
  merchantId    String?  @map("merchant_id")
  saltKey       String?  @map("salt_key")
  saltIndex     Int?     @map("salt_index")
  environment   String   @default("SANDBOX")
  webhookSecret String?  @map("webhook_secret")
  metadata      Json?
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt     DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)

  @@map("payment_gateway_config")
}

model GroupMember {
  id                 String         @id @default(uuid())
  telegramUserId     String         @map("telegram_user_id")
  telegramEntityId   String         @map("telegram_entity_id")
  username           String?
  fullName           String?        @map("full_name")
  telegramInviteLink String         @map("telegram_invite_link")
  joinedAt           DateTime       @default(now()) @map("joined_at") @db.Timestamptz(3)
  memberExpiresAt    DateTime       @map("member_expires_at") @db.Timestamptz(3)
  kickedAt           DateTime?      @map("kicked_at") @db.Timestamptz(3)
  isActive           Boolean        @default(true) @map("is_active")
  metadata           Json?
  createdAt          DateTime       @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt          DateTime       @updatedAt @map("updated_at") @db.Timestamptz(3)
  telegramEntity     TelegramEntity @relation(fields: [telegramEntityId], references: [id], onDelete: Cascade)

  @@unique([telegramUserId, telegramEntityId], name: "telegramUserId_telegramEntityId")
  @@index([telegramEntityId])
  @@index([memberExpiresAt])
  @@index([telegramInviteLink])
  @@map("group_member")
}

model BotMember {
  id             String   @id @default(uuid())
  botId          String   @map("bot_id")
  telegramUserId String   @map("telegram_user_id")
  username       String?
  firstName      String?  @map("first_name")
  lastName       String?  @map("last_name")
  languageCode   String?  @map("language_code")
  isPremium      Boolean  @default(false) @map("is_premium")
  isBot          Boolean  @default(false) @map("is_bot")
  lastActiveAt   DateTime @default(now()) @map("last_active_at") @db.Timestamptz(3)
  metadata       Json?
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt      DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)
  isActive       Boolean  @default(true) @map("is_active")
  bot            Bot      @relation(fields: [botId], references: [id], onDelete: Cascade)

  @@unique([botId, telegramUserId])
  @@index([botId])
  @@index([telegramUserId])
  @@index([username])
  @@index([lastActiveAt])
  @@index([isActive])
  @@map("bot_member")
}

model JoinLog {
  id                String         @id @default(uuid())
  telegramUserId    String         @map("telegram_user_id")
  telegramEntityId  String         @map("telegram_entity_id")
  inviteLinkId      String         @map("invite_link_id")
  username          String?
  fullName          String?        @map("full_name")
  durationType      Int            @map("duration_type")
  durationSeconds   Int            @map("duration_seconds")
  tokensCost        Int            @map("tokens_cost")
  isRenewal         Boolean        @default(false) @map("is_renewal")
  previousExpiresAt DateTime?      @map("previous_expires_at") @db.Timestamptz(3)
  newExpiresAt      DateTime       @map("new_expires_at") @db.Timestamptz(3)
  metadata          Json?
  createdAt         DateTime       @default(now()) @map("created_at") @db.Timestamptz(3)
  telegramEntity    TelegramEntity @relation(fields: [telegramEntityId], references: [id], onDelete: Cascade)

  @@index([telegramUserId])
  @@index([telegramEntityId])
  @@index([inviteLinkId])
  @@index([createdAt])
  @@map("join_log")
}

model BroadcastTemplate {
  id         String      @id @default(uuid())
  name       String
  content    String
  parseMode  String?     @map("parse_mode")
  buttons    Json?
  isActive   Boolean     @default(true) @map("is_active")
  metadata   Json?
  createdAt  DateTime    @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt  DateTime    @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt  DateTime?   @map("deleted_at") @db.Timestamptz(3)
  broadcasts Broadcast[]

  @@index([name])
  @@index([isActive])
  @@map("broadcast_template")
}

model Broadcast {
  id              String             @id @default(uuid())
  botId           String             @map("bot_id")
  templateId      String?            @map("template_id")
  content         String
  parseMode       String?            @map("parse_mode")
  buttons         Json?
  status          Int                @default(0)
  totalRecipients Int                @default(0) @map("total_recipients")
  sentCount       Int                @default(0) @map("sent_count")
  failedCount     Int                @default(0) @map("failed_count")
  filterCriteria  Json?              @map("filter_criteria")
  recipientIds    String[]           @map("recipient_ids")
  startedAt       DateTime?          @map("started_at") @db.Timestamptz(3)
  completedAt     DateTime?          @map("completed_at") @db.Timestamptz(3)
  metadata        Json?
  createdAt       DateTime           @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt       DateTime           @updatedAt @map("updated_at") @db.Timestamptz(3)
  bot             Bot                @relation(fields: [botId], references: [id], onDelete: Cascade)
  template        BroadcastTemplate? @relation(fields: [templateId], references: [id])

  @@index([botId])
  @@index([status])
  @@index([createdAt])
  @@map("broadcast")
}

model TelegramLoginToken {
  id             String   @id @default(uuid())
  token          String   @unique
  telegramUserId String?  @map("telegram_user_id")
  username       String?
  fullName       String?  @map("full_name")
  expiresAt      DateTime @map("expires_at") @db.Timestamptz(3)
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  metadata       Json?

  @@index([token])
  @@index([expiresAt])
  @@map("telegram_login_token")
}

model ForwardRule {
  id                      String         @id @default(uuid())
  userId                  String         @map("user_id")
  botId                   String         @map("bot_id")
  sourceEntityId          String         @map("source_entity_id")
  destinationEntityId     String         @map("destination_entity_id")
  name                    String
  isActive                Boolean        @default(true) @map("is_active")
  scheduleMode            Int            @default(0) @map("schedule_mode")
  batchSize               Int            @default(1) @map("batch_size")
  postInterval            Int            @default(30) @map("post_interval")
  postIntervalUnit        Int            @default(1) @map("post_interval_unit")
  deleteAfterEnabled      Boolean        @default(false) @map("delete_after_enabled")
  deleteInterval          Int?           @map("delete_interval")
  deleteIntervalUnit      Int?           @map("delete_interval_unit")
  broadcastEnabled        Boolean        @default(false) @map("broadcast_enabled")
  broadcastMessage        String?        @map("broadcast_message")
  broadcastParseMode      String?        @map("broadcast_parse_mode")
  broadcastDeleteAfter    Boolean        @default(false) @map("broadcast_delete_after")
  broadcastDeleteInterval Int?           @map("broadcast_delete_interval")
  broadcastDeleteUnit     Int?           @map("broadcast_delete_unit")
  startFromMessageId      Int?           @map("start_from_message_id")
  endAtMessageId          Int?           @map("end_at_message_id")
  shuffle                 Boolean        @default(false)
  repeatWhenDone          Boolean        @default(false) @map("repeat_when_done")
  lastProcessedMsgId      Int?           @map("last_processed_msg_id")
  nextRunAt               DateTime?      @map("next_run_at") @db.Timestamptz(3)
  messageQueue            Int[]          @map("message_queue")
  scheduleStatus          Int            @default(0) @map("schedule_status")
  forwardMedia            Boolean        @default(true) @map("forward_media")
  forwardText             Boolean        @default(true) @map("forward_text")
  forwardDocuments        Boolean        @default(true) @map("forward_documents")
  forwardStickers         Boolean        @default(false) @map("forward_stickers")
  forwardPolls            Boolean        @default(true) @map("forward_polls")
  removeLinks             Boolean        @default(false) @map("remove_links")
  addWatermark            String?        @map("add_watermark")
  includeKeywords         String[]       @map("include_keywords")
  excludeKeywords         String[]       @map("exclude_keywords")
  hideAuthorSignature     Boolean        @default(false) @map("hide_author_signature")
  forwardedCount          Int            @default(0) @map("forwarded_count")
  lastForwardedAt         DateTime?      @map("last_forwarded_at") @db.Timestamptz(3)
  metadata                Json?
  createdAt               DateTime       @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt               DateTime       @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt               DateTime?      @map("deleted_at") @db.Timestamptz(3)
  bot                     Bot            @relation(fields: [botId], references: [id], onDelete: Cascade)
  destinationEntity       TelegramEntity @relation("ForwardDestination", fields: [destinationEntityId], references: [id], onDelete: Cascade)
  sourceEntity            TelegramEntity @relation("ForwardSource", fields: [sourceEntityId], references: [id], onDelete: Cascade)

  @@unique([botId, sourceEntityId, destinationEntityId])
  @@index([userId])
  @@index([botId])
  @@index([sourceEntityId])
  @@index([destinationEntityId])
  @@index([isActive])
  @@index([scheduleMode])
  @@index([nextRunAt])
  @@map("forward_rule")
}

model AutoApprovalRule {
  id               String            @id @default(uuid())
  userId           String            @map("user_id")
  botId            String            @map("bot_id")
  telegramEntityId String            @map("telegram_entity_id")
  name             String
  isActive         Boolean           @default(true) @map("is_active")
  approvalMode     Int               @default(0) @map("approval_mode")
  delayInterval    Int               @default(0) @map("delay_interval")
  delayUnit        Int               @default(0) @map("delay_unit")
  requirePremium   Boolean           @default(false) @map("require_premium")
  requireUsername  Boolean           @default(false) @map("require_username")
  minAccountAge    Int?              @map("min_account_age")
  blockedCountries String[]          @map("blocked_countries")
  sendWelcomeMsg   Boolean           @default(false) @map("send_welcome_msg")
  welcomeMessage   String?           @map("welcome_message")
  approvedCount    Int               @default(0) @map("approved_count")
  rejectedCount    Int               @default(0) @map("rejected_count")
  lastApprovedAt   DateTime?         @map("last_approved_at") @db.Timestamptz(3)
  metadata         Json?
  createdAt        DateTime          @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime          @updatedAt @map("updated_at") @db.Timestamptz(3)
  bot              Bot               @relation(fields: [botId], references: [id], onDelete: Cascade)
  telegramEntity   TelegramEntity    @relation(fields: [telegramEntityId], references: [id], onDelete: Cascade)
  pendingApprovals PendingApproval[]

  @@unique([botId, telegramEntityId])
  @@index([userId])
  @@index([botId])
  @@index([telegramEntityId])
  @@index([isActive])
  @@map("auto_approval_rule")
}

model PendingApproval {
  id           String           @id @default(uuid())
  ruleId       String           @map("rule_id")
  botId        String           @map("bot_id")
  chatId       String           @map("chat_id")
  userId       String           @map("user_id")
  username     String?
  firstName    String?          @map("first_name")
  isPremium    Boolean          @default(false) @map("is_premium")
  scheduledFor DateTime         @map("scheduled_for") @db.Timestamptz(3)
  status       String           @default("pending")
  processedAt  DateTime?        @map("processed_at") @db.Timestamptz(3)
  createdAt    DateTime         @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt    DateTime         @updatedAt @map("updated_at") @db.Timestamptz(3)
  rule         AutoApprovalRule @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([ruleId])
  @@index([status])
  @@index([scheduledFor])
  @@index([botId, chatId, userId])
  @@map("pending_approval")
}

model AutoDropRule {
  id                  String         @id @default(uuid())
  userId              String         @map("user_id")
  botId               String         @map("bot_id")
  telegramEntityId    String         @map("telegram_entity_id")
  name                String
  isActive            Boolean        @default(true) @map("is_active")
  startPostId         Int?           @map("start_post_id")
  endPostId           Int?           @map("end_post_id")
  batchSize           Int            @default(1) @map("batch_size")
  dropInterval        Int            @default(1) @map("drop_interval")
  dropUnit            Int            @default(1) @map("drop_unit")

  // Delivery mode: 0=scheduled (automatic), 1=on-demand (user-triggered via /post or /start)
  deliveryMode        Int            @default(0) @map("delivery_mode")

  // On-demand configuration
  randomSelection     Boolean        @default(false) @map("random_selection")
  totalPostsInSource  Int?           @map("total_posts_in_source")

  // Auto-delete configuration  
  deleteAfterEnabled  Boolean        @default(false) @map("delete_after_enabled")
  deleteTimeout       Int            @default(1200) @map("delete_timeout")

  // VIP message configuration
  vipMessageEnabled   Boolean        @default(false) @map("vip_message_enabled")
  vipMessage          String?        @map("vip_message") @db.Text

  // Cooldown configuration
  cooldownEnabled     Boolean        @default(false) @map("cooldown_enabled")
  cooldownSeconds     Int            @default(480) @map("cooldown_seconds")

  // Welcome message (supports {user} placeholder)
  welcomeMessage      String?        @map("welcome_message") @db.Text

  // Current state
  currentPostId       Int?           @map("current_post_id")
  status              String         @default("stopped") @map("status")
  nextRunAt           DateTime?      @map("next_run_at") @db.Timestamptz(3)

  // Stats
  droppedCount        Int            @default(0) @map("dropped_count")
  lastDroppedAt       DateTime?      @map("last_dropped_at") @db.Timestamptz(3)

  metadata            Json?
  createdAt           DateTime       @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt           DateTime       @updatedAt @map("updated_at") @db.Timestamptz(3)
  hide_forwarded_from Boolean        @default(false)
  hideAuthorSignature Boolean        @default(false) @map("hide_author_signature")
  bot                 Bot            @relation(fields: [botId], references: [id], onDelete: Cascade)
  telegramEntity      TelegramEntity @relation(fields: [telegramEntityId], references: [id], onDelete: Cascade)

  @@unique([botId, telegramEntityId])
  @@index([userId])
  @@index([botId])
  @@index([telegramEntityId])
  @@index([isActive])
  @@index([status])
  @@index([nextRunAt])
  @@map("auto_drop_rule")
}

model WelcomeConfig {
  id               String         @id @default(uuid())
  userId           String         @map("user_id")
  botId            String         @map("bot_id")
  telegramEntityId String         @map("telegram_entity_id")
  welcomeEnabled   Boolean        @default(false) @map("welcome_enabled")
  welcomeMessage   String?        @map("welcome_message")
  welcomeParseMode String?        @map("welcome_parse_mode")
  welcomeButtons   Json?          @map("welcome_buttons")
  goodbyeEnabled   Boolean        @default(false) @map("goodbye_enabled")
  goodbyeMessage   String?        @map("goodbye_message")
  goodbyeParseMode String?        @map("goodbye_parse_mode")
  deleteAfterSecs  Int?           @map("delete_after_secs")
  mentionUser      Boolean        @default(true) @map("mention_user")
  metadata         Json?
  createdAt        DateTime       @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime       @updatedAt @map("updated_at") @db.Timestamptz(3)
  bot              Bot            @relation(fields: [botId], references: [id], onDelete: Cascade)
  telegramEntity   TelegramEntity @relation(fields: [telegramEntityId], references: [id], onDelete: Cascade)

  @@unique([botId, telegramEntityId])
  @@index([userId])
  @@index([botId])
  @@index([telegramEntityId])
  @@map("welcome_config")
}

model PaymentOrder {
  id               String   @id @default(uuid())
  userId           String   @map("user_id")
  orderId          String   @unique @map("order_id")
  amount           Float
  currency         String   @default("INR")
  status           Int
  type             Int
  referenceId      String?  @map("reference_id")
  paymentSessionId String?  @map("payment_session_id")
  metadata         Json?
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt        DateTime @updatedAt @map("updated_at") @db.Timestamptz(3)
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([orderId])
  @@map("payment_order")
}

model TokenBundle {
  id          String    @id @default(uuid())
  name        String
  description String?
  tokens      Int
  price       Float
  currency    String    @default("INR")
  isActive    Boolean   @default(true) @map("is_active")
  metadata    Json?
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt   DateTime  @updatedAt @map("updated_at") @db.Timestamptz(3)
  deletedAt   DateTime? @map("deleted_at") @db.Timestamptz(3)

  @@map("token_bundle")
}

model DailyTokenClaim {
  id             String       @id @default(uuid())
  userId         String       @map("user_id")
  subscriptionId String       @map("subscription_id")
  tokensGranted  Int          @map("tokens_granted")
  claimDate      DateTime     @map("claim_date") @db.Date
  createdAt      DateTime     @default(now()) @map("created_at") @db.Timestamptz(3)
  subscription   Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, claimDate])
  @@index([userId])
  @@index([subscriptionId])
  @@index([claimDate])
  @@map("daily_token_claim")
}
